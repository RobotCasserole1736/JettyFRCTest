<!DOCTYPE html>

<html>
<title>Casserole Driver Data View</title>

<head>
  <link rel="stylesheet" href="./main.css">
</head>

<body>

<h1>FRC 1736 Driver View</h1>
<hr>
<div/>
<h3>COM Status:</h3>
<div id="id01">Socket Not Open</div>

<br>

<canvas id="dial1" width="200" height="200" style="background-color:#333"></canvas>
<canvas id="dial2" width="200" height="200" style="background-color:#333"></canvas>
<canvas id="dial3" width="200" height="200" style="background-color:#333"></canvas>

<br>

<!-- Common navigation bar -->
<hr>
<div style="background-color:#ce7777">
<p>
<a href="./../index.html">Home</a>
        
<a href="./presentState.html">State Data</a>
        
<a href="./calibration.html">Calibration</a>
        
<a href="./driverView.html">Driver View</a>
</p>
</div>
<!-- END Common navigation bar -->



<script>
var dataSocket = new WebSocket("ws://127.0.0.1:8080/driverviewstream")
var numTransmissions = 0;


//Class for a dial

var casseroleDial = function(elementID, min_in, max_in, step_in, name_in) {
    this.min = min_in;
    this.max = max_in;
    this.step = step_in;
    this.name = name_in;
    this.value = min_in;
    this.canvas = document.getElementById(elementID);
    this.ctx = this.canvas.getContext("2d");
    this.radius = this.canvas.height / 2;
    this.ctx.translate(this.radius, this.radius);
    this.radius = this.radius * 0.90;
    this.drawDial();
}

casseroleDial.prototype.setValue = function(new_value){
    this.value = new_value;
    this.drawHand();
    this.drawValue();
}

casseroleDial.prototype.drawDial = function() {
    this.drawFace();
    this.drawNumbers()
    this.drawHand();
    this.drawName();
    this.drawValue();
}

casseroleDial.prototype.drawFace = function() {
    var grad;

    this.ctx.beginPath();
    this.ctx.arc(0, 0, this.radius, 0.75*Math.PI, 2.25*Math.PI);
    this.ctx.fillStyle = 'white';
    this.ctx.fill();

    grad = this.ctx.createRadialGradient(0,0,this.radius*0.95, 0,0,this.radius*1.05);
    grad.addColorStop(0, '#333');
    grad.addColorStop(0.5, 'white');
    grad.addColorStop(1, '#333');
    this.ctx.strokeStyle = grad;
    this.ctx.lineWidth = this.radius*0.1;
    this.ctx.stroke();

    this.ctx.beginPath();
    this.ctx.arc(0, 0, this.radius*0.1, 0, 2*Math.PI);
    this.ctx.fillStyle = '#333';
    this.ctx.fill();
}

casseroleDial.prototype.drawNumbers = function() {
    var ang;
    var num;
    this.ctx.font = this.radius*0.15 + "px arial";
    this.ctx.textBaseline="middle";
    this.ctx.textAlign="center";
    for(num= this.min; num <= this.max; num+=this.step){
        ang = (num/this.step * (this.step/(this.max-this.min)) * (1.5*Math.PI))  + 1.25*Math.PI;
        this.ctx.rotate(ang);
        this.ctx.translate(0, -this.radius*0.85);
        this.ctx.rotate(-ang);
        this.ctx.fillText(num.toString(), 0, 0);
        this.ctx.rotate(ang);
        this.ctx.translate(0, this.radius*0.85);
        this.ctx.rotate(-ang);
    }
}

casseroleDial.prototype.drawName = function() {
    this.ctx.translate(0, this.radius*0.9);
    this.ctx.font=this.radius*0.18 + "px arial";
    this.ctx.fillStyle="#EE0000";
    this.ctx.fillText(this.name, 0, 0);
    this.ctx.translate(0, -this.radius*0.9);

} 

casseroleDial.prototype.drawValue = function() {
    this.ctx.translate(0, this.radius*0.4);
    this.ctx.font=this.radius*0.18 + "px arial";
    this.ctx.fillStyle="#00AA00";
    this.ctx.fillText(this.value.toString(), 0, 0);
    this.ctx.translate(0, -this.radius*0.4);

} 

casseroleDial.prototype.drawHand = function() {
    var pos = (this.value)/(this.max-this.min)*(1.5*Math.PI) + 1.25*Math.PI;
    this.ctx.beginPath();
    this.ctx.lineWidth = this.radius*0.08;
    this.ctx.lineCap = "round";
    this.ctx.moveTo(0,0);
    this.ctx.rotate(pos);
    this.ctx.lineTo(0, -this.radius*0.7);
    this.ctx.stroke();
    this.ctx.rotate(-pos);
}

//END Dial Class

//Data socket handlers
dataSocket.onopen = function (event) {
  document.getElementById("id01").innerHTML = "Socket Open";
};

dataSocket.onerror = function (error) {
  document.getElementById("id01").innerHTML = "Error with socket";
};

dataSocket.onmessage = function (event) {
  genTable(event.data);
  numTransmissions = numTransmissions + 1;
  document.getElementById("id01").innerHTML = "Socket Open. RX Count:" + numTransmissions; 
};




//Main Execution

var testDial1 = new casseroleDial("dial1", 0, 200, 20, "Test Name #1 (RPM)");

//testDial1.setValue(135.2)

</script>

</body>
</html>

